(function(d,g){var c=document.location;d.Router=b;function b(i){if(!(this instanceof b)){return new b(i)}var k=this;this.routes=i;var m;this.recurse=function(o){if(o===g){return recurse}m=(this._recurse=o)==="forward"?"unshift":"push"};this._recurse=null;this.recurse(null);this.resource=null;this.state={};this.after=[];this.on=[];this.once=[];this.oneach=[];this.aftereach=[];this.notfound=null;this.lastroutevalue=null;this.alreadyrun=false;function h(o){for(var p in o){h(o[p]);if(p.indexOf(":")!==-1){var q=p.replace(/:.*?\/|:.*?$/g,"([a-z0-9-]+)/").slice(0,-1);o[q]=o[p];delete o[p]}}}h(this.routes);function l(t){for(var p=0,o=k[t].length;p<o;p++){var q=k[t][p];var r=q.val===null?k.lastroutevalue:q.val;if(typeof q.fn==="string"){q.fn=k.resource[q.fn]}if(typeof r==="string"){r=[r]}if(q.fn.apply(k.resource||null,r||[])===false){k[t]=[];return false}if(q.val!==null){k.lastroutevalue=q.val}}}function n(C,D,x,q){var u,y;var B=C[D];if(!B){for(var p in C){if(C.hasOwnProperty(p)){y=D.match(new RegExp("^"+p));u=D.match(new RegExp("^"+p+"(.*)?"));if(y&&u){for(var v=u.length;v>=0;v--){if(u[v]){u[v]=u[v].replace(/^\//,"")}else{u.splice(v,1)}}var t=y[0].split("/").length-1,z=u.slice(y.length),A=x-t,o=q.concat(y.slice(1));if(y.length>1){B=C[p]}else{B=C[y[0]]}if(w(z,A,o)){return true}}}}}else{A=x-D.split("/").length+1}w("/",A,q);function w(G,F,E){if(B){if(typeof G!=="string"){G="/"+G.join("/")}if(G!=="/"){n(B,G,F,E)}if(F===0||k._recurse){function r(K,J){if(K&&K[0]){for(var I=0,H=K.length;I<H;I++){k[J][m]({fn:K[I],val:E||G})}}else{k[J][m]({fn:K,val:E||G})}}if(typeof B==="function"||B.on){r(B.on||B,"on")}if(B.once&&!B.once._fired){B.once._fired=true;r(B.once,"once")}if(B.after){r(B.after,"after")}return true}}else{k.noroute(E)}}return true}function j(p){var q=c.hash.slice(1);var o=q.split("/").length-1;k.after=[];if(n(k.routes,q,o,[])){l("on");l("once");l("oneach");k.on=[];k.once=[]}l("after");l("aftereach")}this.init=function(o){e.init(j);if(c.hash.length<1&&o){c.hash=o}if(c.hash.length>0){j()}return this};this.destroy=function(){e.destroy(j);return this};return this}b.prototype.use=function(k){for(var p in k){if(k.hasOwnProperty(p)){if(p==="recurse"){this.recurse(k[p]);continue}if(p==="resource"){this.resource=k[p];continue}if(p==="notfound"){this.notfound=k[p];continue}var o=k[p];var j=null;var n=({}).toString.call(o);if(p==="on"){j="oneach"}if(p==="after"){j="aftereach"}if(n.indexOf("Array")!==-1){for(var m=0,h=o.length;m<h;m++){this[j].push({fn:o[m],val:null})}}else{this[j].push({fn:o,val:null})}}}return this};b.prototype.noroute=function(j){if(this.notfound){if(({}).toString.call(this.notfound).indexOf("Array")!==-1){for(var k=0,h=this.notfound.length;k<h;k++){this.notfound[k](j)}}else{this.notfound(j)}}};b.prototype.explode=function(){var h=c.hash;if(h[1]==="/"){h=h.slice(1)}return h.slice(1,h.length).split("/")};b.prototype.setRoute=function(k,h,l){var j=this.explode();if(typeof k==="number"&&typeof h==="string"){j[k]=h}else{if(typeof l==="string"){j.splice(k,h,s)}else{j=[k]}}e.setHash(j.join("/"));return j};b.prototype.getState=function(){return this.state};b.prototype.getRoute=function(i){var j=i;if(typeof i==="number"){j=this.explode()[i]}else{if(typeof i==="string"){var k=this.explode();j=k.indexOf(i)}else{j=this.explode()}}return j};var a="0.4.0",f="modern",e={hash:c.hash,check:function(){var i=c.hash;if(i!=this.hash){this.hash=i;this.onHashChanged()}},fire:function(){if(f==="modern"){d.onhashchange()}else{this.onHashChanged()}},init:function(j){var h=this;if(!d.Router.listeners){d.Router.listeners=[]}function i(){for(var n=0,m=d.Router.listeners.length;n<m;n++){d.Router.listeners[n]()}}if("onhashchange" in d&&(document.documentMode===g||document.documentMode>7)){d.onhashchange=i;f="modern"}else{var k=document.createElement("iframe");k.id="state-frame";k.style.display="none";document.body.appendChild(k);this.writeFrame("");if("onpropertychange" in document&&"attachEvent" in document){document.attachEvent("onpropertychange",function(){if(event.propertyName==="location"){h.check()}})}d.setInterval(function(){h.check()},50);this.onHashChanged=i;f="legacy"}d.Router.listeners.push(j);return f},destroy:function(k){if(!d.Router||!d.Router.listeners){return}var j=d.Router.listeners;for(var h=j.length-1;h>=0;h--){if(j[h]===k){j.splice(h,1)}}},setHash:function(h){if(f==="legacy"){this.writeFrame(h)}c.hash=(h[0]==="/")?h:"/"+h;return this},writeFrame:function(h){var i=document.getElementById("state-frame");var j=i.contentDocument||i.contentWindow.document;j.open();j.write("<script>_hash = '"+h+"'; onload = parent.listener.syncHash;<script>");j.close()},syncHash:function(){var h=this._hash;if(h!=c.hash){c.hash=h}return this},onHashChanged:function(){}}}(window));